<?

//-------------------------------------------------------------------------------------------------
//*	download all outstanding files from a peer
//-------------------------------------------------------------------------------------------------

	//---------------------------------------------------------------------------------------------
	//	auth
	//---------------------------------------------------------------------------------------------
	if ('admin' != $user->role) { $page->do403(); }

	//---------------------------------------------------------------------------------------------
	//	get a list of all files from the images module and add to download queue
	//---------------------------------------------------------------------------------------------
	$list = $theme->expandBlocks("[[:images::listallfiles:]]", '');
	$list = explode("\n", $list);

	foreach($list as $fileName) {	
		if ( (trim($fileName) != '') && (false == $kapenta->fileExists($fileName)) ) {
			//-------------------------------------------------------------------------------------
			// filename is valid and does not exist on this server
			//-------------------------------------------------------------------------------------
			$sync->requestFile($fileName);
			//echo ">> " . $fileName . "<br/>\n";
		}
	}

	$page->do302('sync/downloads/');	

?>
