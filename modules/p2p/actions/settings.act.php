<?

//--------------------------------------------------------------------------------------------------
//*	form for editing P2P client settings
//--------------------------------------------------------------------------------------------------

	//----------------------------------------------------------------------------------------------
	//	check user role
	//----------------------------------------------------------------------------------------------
	if ('admin' != $user->role) { $page->do403(); }

	//----------------------------------------------------------------------------------------------
	//	handle POST vars
	//----------------------------------------------------------------------------------------------
	if (true == array_key_exists('action', $_POST)) {
		
		//------------------------------------------------------------------------------------------
		//	change registry settings (excluding password)
		//------------------------------------------------------------------------------------------

		if ('changeSettings' == $_POST['action']) {
			foreach($_POST as $key => $value) {
				switch($key) {
					case 'p2p_enabled':			$registry->set('p2p.enabled', $value);		break;
					case 'p2p_server_uid':		$registry->set('p2p.server.uid', $value);	break;
					case 'p2p_server_name':		$registry->set('p2p.server.name', $value);	break;
					case 'p2p_server_url':		$registry->set('p2p.server.url', $value);	break;
				}
			}

			$msg = "Updated registry settings:<br/>\n"
				. "<b>p2p.enabled:</b> " . $registry->get('p2p.enabled') . "<br/>"
				. "<b>p2p.server.uid:</b> " . $registry->get('p2p.server.uid') . "<br/>"
				. "<b>p2p.server.name:</b> " . $registry->get('p2p.server.name') . "<br/>"
				. "<b>p2p.server.url:</b> " . $registry->get('p2p.server.url') . "<br/>";

			$session->msg($msg, 'ok');
		}

		//------------------------------------------------------------------------------------------
		//	change password
		//------------------------------------------------------------------------------------------
		//TODO

		//------------------------------------------------------------------------------------------
		//	test settings
		//------------------------------------------------------------------------------------------

	}

	//----------------------------------------------------------------------------------------------
	//	render the page
	//----------------------------------------------------------------------------------------------
	$page->load('modules/p2p/actions/settings.page.php');
	$page->render();

?>
